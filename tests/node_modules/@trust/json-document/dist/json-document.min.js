var JSONDocument=function(e){function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){e.exports=t(1)},function(e,n,t){"use strict";e.exports={Formats:t(2),Initializer:t(3),JSONDocument:t(4),JSONMapping:t(7),JSONPatch:t(5),JSONPointer:t(6),JSONSchema:t(8),Validator:t(9)}},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s][0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,a=/^(?:[a-z][a-z0-9+-.]*)?(?:\:|\/)\/?[^\s]*$/i,o=/^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,s=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,u=/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,l=/^[a-z](?:(?:[-0-9a-z]{0,61})?[0-9a-z])?(\.[a-z](?:(?:[-0-9a-z]{0,61})?[0-9a-z])?)*$/i,c=function(){function e(){t(this,e)}return r(e,[{key:"register",value:function(e,n){if("string"!=typeof e)throw new Error("Format name must be a string");return"string"==typeof n&&(n=new RegExp(n)),this[e]=n}},{key:"resolve",value:function(e){var n=this[e];if(!n)throw new Error("Unknown JSON Schema format.");return n}},{key:"test",value:function(e,n){var t=this.resolve(e);return t.test(n)}}],[{key:"initialize",value:function(){var n=new e;return n.register("date-time",i),n.register("uri",a),n.register("email",o),n.register("ipv4",s),n.register("ipv6",u),n.register("hostname",l),n}}]),e}();e.exports=c.initialize()},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),a=function(){function e(n,r){t(this,e),Object.assign(this,r||{}),this.root=this.root||this,this.root.depth=this.root.depth||1,this.level>this.root.depth&&(this.root.depth=this.level),this.level=this.level||0,this.schema=n}return i(e,[{key:"compile",value:function(){var e=this.root,n=(this.depth,this.level,""),t="";if(t+=this.default(),t+=this.properties(),t+=this.items(),t+=this.member(),t+=this.item(),e===this){for(var r=1;r<=this.root.depth;r++)n+=this.declaration(r);return"\n        options = options || {}\n\n        if (options.filter === false) {\n          Object.assign(target, JSON.parse(JSON.stringify(source)))\n        }\n\n        "+n+"\n        "+t+"\n      "}return t}},{key:"declaration",value:function(e){return"\n      var target"+e+"\n      var source"+e+"\n      var count"+e+"\n    "}},{key:"default",value:function(){var e=this.schema,n=this.level,t=this.key,r=this.index,i=e.default,a="";return e.hasOwnProperty("default")&&(t&&(a+="\n          target"+n+"['"+t+"'] = "+JSON.stringify(i)+"\n        "),r&&(a+="\n          target"+n+"["+r+"] = "+JSON.stringify(i)+"\n        "),n>1&&(a+="\n          count"+n+"++\n        "),a="\n        if (options.defaults !== false) {\n          "+a+"\n        }\n      "),a}},{key:"member",value:function(){var e=this.schema,n=(this.root,this.level),t=this.key,r=e.properties,i=e.additionalProperties,a=e.items,o=e.additionalItems,s="";return!t||r||i||a||o||(s+="\n        target"+n+"['"+t+"'] = source"+n+"['"+t+"']\n      ",n>1&&(s+="\n          count"+n+"++\n        "),s="\n        if (source"+n+".hasOwnProperty('"+t+"')) {\n          "+s+"\n        }\n      "),s}},{key:"item",value:function(){var e=this.schema,n=(this.root,this.level),t=this.index,r=e.properties,i=e.additionalProperties,a=e.items,o=e.additionalItems,s="";return!t||r||i||a||o||(s+="\n        target"+n+"["+t+"] = source"+n+"["+t+"]\n      ",n>1&&(s+="\n          count"+n+"++\n        "),s="\n        if ("+t+" < len) {\n          "+s+"\n        }\n      "),s}},{key:"properties",value:function n(){var t=this.schema,r=this.root,i=this.level,a=this.key,o=this.index,n=t.properties,s="";return n&&(Object.keys(n).forEach(function(t){var a=n[t],o=new e(a,{key:t,root:r,level:i+1});s+=o.compile()}),r===this?s="\n          if (typeof source === 'object' && source !== null && !Array.isArray(source)) {\n            if (typeof target !== 'object') {\n              throw new Error('?')\n            }\n\n            source1 = source\n            target1 = target\n            count1 = 0\n\n            "+s+"\n          }\n        ":(o&&(s="\n            if ("+o+" < source"+i+".length || typeof source"+i+"["+o+"] === 'object') {\n\n              source"+(i+1)+" = source"+i+"["+o+"] || {}\n              count"+(i+1)+" = 0\n\n              if ("+o+" < target"+i+".length || typeof target"+i+"["+o+"] !== 'object') {\n                target"+(i+1)+" = {}\n                if ("+o+" < source"+i+".length) {\n                  count"+(i+1)+"++\n                }\n              } else {\n                target"+(i+1)+" = target"+i+"["+o+"]\n              }\n\n              "+s+"\n\n              if (count"+(i+1)+" > 0) {\n                target"+i+"["+o+"] = target"+(i+1)+"\n                count"+i+"++\n              }\n\n            } else {\n              target"+i+"["+o+"] = source"+i+"["+o+"]\n              count"+i+"++\n            }\n          "),a&&(s="\n            if ((typeof source"+i+"['"+a+"'] === 'object'\n                  && source"+i+"['"+a+"'] !== null\n                  && !Array.isArray(source"+i+"['"+a+"']))\n                || !source"+i+".hasOwnProperty('"+a+"')) {\n\n              source"+(i+1)+" = source"+i+"['"+a+"'] || {}\n              count"+(i+1)+" = 0\n\n              if (!target"+i+".hasOwnProperty('"+a+"')\n                  || typeof target"+i+"['"+a+"'] !== 'object'\n                  || target"+i+"['"+a+"'] === null\n                  || Array.isArray(target"+i+"['"+a+"'])) {\n                target"+(i+1)+" = {}\n                if (source"+i+".hasOwnProperty('"+a+"')) {\n                  count"+(i+1)+"++\n                }\n              } else {\n                target"+(i+1)+" = target"+i+"['"+a+"']\n                count"+(i+1)+"++\n              }\n\n              "+s+"\n\n              if (count"+(i+1)+" > 0) {\n                target"+i+"['"+a+"'] = target"+(i+1)+"\n                count"+i+"++\n              }\n\n            } else {\n              target"+i+"['"+a+"'] = source"+i+"['"+a+"']\n              count"+i+"++\n            }\n          "))),s}},{key:"additionalProperties",value:function(){}},{key:"items",value:function n(){var t=this.schema,i=this.root,a=this.level,o=this.key,n=(this.index,t.items),s="";if(n){if(Array.isArray(n));else if("object"===("undefined"==typeof n?"undefined":r(n))&&null!==n){var u="i"+(a+1),l=new e(n,{index:u,root:i,level:a+1});s+="\n          var sLen = source"+(a+1)+".length || 0\n          var tLen = target"+(a+1)+".length || 0\n          var len = 0\n\n          if (sLen > len) { len = sLen }\n          // THIS IS WRONG, CAUSED SIMPLE ARRAY INIT TO FAIL (OVERWRITE\n          // EXISTING TARGET VALUES WITH UNDEFINED WHEN SOURCE IS SHORTER THAN\n          // TARGET). LEAVING HERE UNTIL WE FINISH TESTING AND SEE WHY IT MIGHT\n          // HAVE BEEN HERE IN THE FIRST PLACE.\n          //\n          // if (tLen > len) { len = tLen }\n\n          for (var "+u+" = 0; "+u+" < len; "+u+"++) {\n            "+l.compile()+"\n          }\n        "}s=i===this?"\n          if (Array.isArray(source)) {\n            if (!Array.isArray(target)) {\n              throw new Error('?')\n            }\n\n            source1 = source\n            target1 = target\n\n            "+s+"\n          }\n        ":"\n          if (Array.isArray(source"+a+"['"+o+"']) || !source"+a+".hasOwnProperty('"+o+"')) {\n\n            source"+(a+1)+" = source"+a+"['"+o+"'] || []\n            count"+(a+1)+" = 0\n\n            if (!target"+a+".hasOwnProperty('"+o+"') || !Array.isArray(target"+a+"['"+o+"'])) {\n              target"+(a+1)+" = []\n                if (source"+a+".hasOwnProperty('"+o+"')) {\n                  count"+(a+1)+"++\n                }\n\n            } else {\n              target"+(a+1)+" = target"+a+"['"+o+"']\n              count"+(a+1)+"++\n            }\n\n            "+s+"\n\n            if (count"+(a+1)+" > 0) {\n              target"+a+"['"+o+"'] = target"+(a+1)+"\n              count"+a+"++\n            }\n\n          } else {\n            target"+a+"['"+o+"'] = source"+a+"['"+o+"']\n            count"+a+"++\n          }\n        "}return s}},{key:"additionalItems",value:function(){}}],[{key:"compile",value:function(n){var t=new e(n),r=t.compile();try{return new Function("target","source","options",r)}catch(e){console.log(e,e.stack)}}}]),e}();e.exports=a},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),a=t(5),o=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e),this.initialize(n,t)}return i(e,null,[{key:"schema",get:function(){throw new Error("Schema must be defined by classes extending JSONDocument")}}]),i(e,[{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=this.constructor.schema;t.initialize(this,e,n)}},{key:"validate",value:function(e){var n=this.constructor.schema;return(e||n).validate(this)}},{key:"patch",value:function e(n){var e=new a(n);e.apply(this)}},{key:"select",value:function(){}},{key:"project",value:function(e){return e.project(this)}}],[{key:"serialize",value:function(e){return JSON.stringify(e)}},{key:"deserialize",value:function(e){try{return JSON.parse(e)}catch(e){throw new Error("Failed to parse JSON")}}}]),e}();e.exports=o},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),o=t(6),s=2,u=["add","remove","replace","move","copy","test"],l=function(){function e(n){r(this,e),this.ops=n||[]}return a(e,[{key:"apply",value:function(e){var n=this;this.ops.forEach(function(t){var r=t.op;if(!r)throw new Error('Missing "op" in JSON Patch operation');if(u.indexOf(r)===-1)throw new Error('Invalid "op" in JSON Patch operation');if(!t.path)throw new Error('Missing "path" in JSON Patch operation');n[r](t,e)})}},{key:"add",value:function(e,n){if(void 0===e.value)throw new Error('Missing "value" in JSON Patch add operation');var t=new o(e.path,s);t.add(n,e.value)}},{key:"remove",value:function(e,n){var t=new o(e.path);t.remove(n)}},{key:"replace",value:function(e,n){if(void 0===e.value)throw new Error('Missing "value" in JSON Patch replace operation');var t=new o(e.path);t.replace(n,e.value)}},{key:"move",value:function(e,n){if(void 0===e.from)throw new Error('Missing "from" in JSON Patch move operation');if(e.path.match(new RegExp("^"+e.from)))throw new Error('Invalid "from" in JSON Patch move operation');var t=new o(e.path),r=new o(e.from),i=r.get(n);r.remove(n),t.add(n,i)}},{key:"copy",value:function(e,n){if(void 0===e.from)throw new Error('Missing "from" in JSON Patch copy operation');var t=new o(e.path),r=new o(e.from),i=r.get(n);t.add(n,i)}},{key:"test",value:function(e,n){if(void 0===e.value)throw new Error('Missing "value" in JSON Patch test operation');var t=new o(e.path),r=t.get(n);switch(i(e.value)){default:if(r!==e.value)throw new Error("Mismatching JSON Patch test value")}}}]),e}();e.exports=l},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=0,a=1,o=2,s=function(){function e(n,r){t(this,e),this.expr=n,this.mode=r||i,this.tokens=n&&"#"===n.charAt(0)?this.parseURIFragmentIdentifier(n):this.parseJSONString(n)}return r(e,[{key:"escape",value:function(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}},{key:"unescape",value:function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}},{key:"parseJSONString",value:function(e){if("string"!=typeof e)throw new Error("JSON Pointer must be a string");if(""===e)return[];if("/"!==e.charAt(0))throw new Error("Invalid JSON Pointer");return"/"===e?[""]:e.substr(1).split("/").map(this.unescape)}},{key:"toJSONString",value:function(){return"/"+this.tokens.map(this.escape).join("/")}},{key:"parseURIFragmentIdentifier",value:function(e){if("string"!=typeof e)throw new Error("JSON Pointer must be a string");if("#"!==e.charAt(0))throw new Error("Invalid JSON Pointer URI Fragment Identifier");return this.parseJSONString(decodeURIComponent(e.substr(1)))}},{key:"toURIFragmentIdentifier",value:function(){var e=this,n=this.tokens.map(function(n){return encodeURIComponent(e.escape(n))}).join("/");return"#/"+n}},{key:"get",value:function(e){for(var n=e,t=this.tokens,r=0;r<t.length;r++){if(!n||void 0===n[t[r]]){if(this.mode!==i)return;throw new Error("Invalid JSON Pointer reference")}n=n[t[r]]}return n}},{key:"add",value:function(e,n){for(var t=this.tokens,r=e,s=0;s<t.length;s++){var u=t[s];if(s===t.length-1)"-"===u?r.push(n):Array.isArray(r)?r.splice(u,0,n):void 0!==n&&(r[u]=n);else if(r[u])r=r[u];else switch(this.mode){case i:throw new Error("Invalid JSON Pointer reference");case a:r=r[u]=parseInt(u)?[]:{};break;case o:return;default:throw new Error("Invalid pointer mode")}}}},{key:"replace",value:function(e,n){for(var t=this.tokens,r=e,i=0;i<t.length;i++){var a=t[i];i===t.length-1?r[a]=n:r=r[a]?r[a]:r[a]=parseInt(a)?[]:{}}}},{key:"remove",value:function(e){for(var n=this.tokens,t=e,r=0;r<n.length;r++){var i=n[r];if(void 0===t||void 0===t[i])return;if(Array.isArray(t))return void t.splice(i,1);r===n.length-1&&delete t[i],t=t[i]}}}],[{key:"parse",value:function(n){return new e(n)}}]),e}();e.exports=s},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),a=t(6),o=1,s=function(){function e(n){var t=this;r(this,e),Object.defineProperty(this,"mapping",{enumerable:!1,value:new Map}),Object.keys(n).forEach(function(e){var r=n[e];t.mapping.set(new a(e,o),new a(r,o))})}return i(e,[{key:"map",value:function(e,n){this.mapping.forEach(function(t,r){r.add(e,t.get(n))})}},{key:"project",value:function(e,n){this.mapping.forEach(function(t,r){t.add(n,r.get(e))})}}]),e}();e.exports=s},function(e,n,t){"use strict";function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),s=t(3),u=t(9),l=function(){function e(n){i(this,e),Object.assign(this,n),Object.defineProperties(this,{initialize:{enumerable:!1,writeable:!1,value:s.compile(n)},validate:{enumerable:!1,writeable:!1,value:u.compile(n)}})}return o(e,[{key:"extend",value:function(n){function t(e){return e&&"object"===("undefined"==typeof e?"undefined":a(e))&&null!==e&&!Array.isArray(e)}function i(e,n){var a=Object.assign({},e);return t(e)&&t(n)&&Object.keys(n).forEach(function(o){t(n[o])&&o in e?a[o]=i(e[o],n[o]):Object.assign(a,r({},o,n[o]))}),a}var o=i(this,n);return new e(o)}}]),e}();e.exports=l},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),o=t(2),s=0,u=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e),this.schema=n,Object.assign(this,t),this.address||(this.address=""),this.require!==!0&&(this.require=!1)}return a(e,null,[{key:"compile",value:function(n){var t=new e(n),r='\n      // "cursor"\n      let value = data\n      let container\n      let stack = []\n      let top = -1\n\n      // error state\n      let valid = true\n      let errors = []\n\n      // complex schema state\n      let initialValidity\n      let anyValid\n      let notValid\n      let countOfValid\n      let initialErrorCount\n      let accumulatedErrorCount\n\n      // validation code\n      '+t.compile()+"\n\n      // validation result\n      return {\n        valid,\n        errors\n      }\n    ";return new Function("data",r)}},{key:"counter",get:function(){return s++}}]),a(e,[{key:"compile",value:function(){var e="";return this.require&&(e+=this.required()),e+=this.type(),e+=this.array(),e+=this.number(),e+=this.object(),e+=this.string(),e+=this.enum(),e+=this.anyOf(),e+=this.allOf(),e+=this.not(),e+=this.oneOf()}},{key:"push",value:function(){return"\n      stack.push(value)\n      container = value\n      top++\n    "}},{key:"pop",value:function(){return"\n      if (stack.length > 1) {\n        top--\n        stack.pop()\n      }\n\n      value = container = stack[top]\n    "}},{key:"type",value:function e(){var e=this.schema.type,n=this.address,t="";if(e){var r=Array.isArray(e)?e:[e],i=r.map(function(e){return"array"===e?"!Array.isArray(value)":"boolean"===e?"typeof value !== 'boolean'":"integer"===e?"!Number.isInteger(value)":"null"===e?"value !== null":"number"===e?"typeof value !== 'number'":"object"===e?"(typeof value !== 'object' || Array.isArray(value) || value === null)":"string"===e?"typeof value !== 'string'":void 0}).join(" && ");t+="\n      // "+n+" type checking\n      if (value !== undefined && "+i+") {\n        valid = false\n        errors.push({\n          keyword: 'type',\n          message: 'invalid type'\n        })\n      }\n      "}return t}},{key:"array",value:function(){var e=["additionalItems","items","minItems","maxItems","uniqueItems"],n=this.validations(e),t="";return n.length>0&&(t+="\n      /**\n       * Array validations\n       */\n      if (Array.isArray(value)) {\n      "+n+"\n      }\n      "),t}},{key:"number",value:function(){var e=["minimum","maximum","multipleOf"],n=this.validations(e),t="";return n.length>0&&(t+="\n      /**\n       * Number validations\n       */\n      if (typeof value === 'number') {\n      "+n+"\n      }\n      "),t}},{key:"object",value:function(){var e=["maxProperties","minProperties","additionalProperties","properties","patternProperties","dependencies","schemaDependencies","propertyDependencies"],n=this.validations(e),t="";return n.length>0&&(t+="\n      /**\n       * Object validations\n       */\n      if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      "+n+"\n      }\n      "),t}},{key:"string",value:function(){var e=["maxLength","minLength","pattern","format"],n=this.validations(e),t="";return n.length>0&&(t+="\n      /**\n       * String validations\n       */\n      if (typeof value === 'string') {\n      "+n+"\n      }\n      "),t}},{key:"validations",value:function(e){var n=this,t=this.schema,r="",i=Object.keys(t).filter(function(n){return e.indexOf(n)!==-1});return i.forEach(function(e){r+=n[e]()}),r}},{key:"enum",value:function(){var e=this.schema.enum,n=this.address,t=["value !== undefined"],r="";return e&&(e.forEach(function(e){switch("undefined"==typeof e?"undefined":i(e)){case"boolean":t.push("value !== "+e);break;case"number":t.push("value !== "+e);break;case"string":t.push('value !== "'+e+'"');break;case"object":null===e?t.push("value !== null"):t.push("'"+JSON.stringify(e)+"' !== JSON.stringify(value)");break;default:throw new Error("Things are not well in the land of enum")}}),r+='\n      /**\n       * Validate "'+n+'" enum\n       */\n      if ('+t.join(" && ")+") {\n        valid = false\n        errors.push({\n          keyword: 'enum',\n          message: JSON.stringify(value) + ' is not an enumerated value'\n        })\n      }\n      "),r}},{key:"anyOf",value:function n(){var n=this.schema.anyOf,t=this.address,r="";return Array.isArray(n)&&(r+="\n        initialValidity = valid\n        initialErrorCount = errors.length\n        anyValid = false\n      ",n.forEach(function(n){var i=new e(n,{address:t});r+="\n        accumulatedErrorCount = errors.length\n        "+i.compile()+"\n        if (accumulatedErrorCount === errors.length) {\n          anyValid = true\n        }\n        "}),r+="\n          if (anyValid === true) {\n            valid = initialValidity\n            errors = errors.slice(0, initialErrorCount)\n          }\n      "),r}},{key:"allOf",value:function n(){var n=this.schema.allOf,t=this.address,r="";return Array.isArray(n)&&n.forEach(function(n){var i=new e(n,{address:t});r+="\n        "+i.compile()+"\n        "}),r}},{key:"oneOf",value:function n(){var n=this.schema.oneOf,t=this.address,r="";return Array.isArray(n)&&(r+="\n        /**\n         * Validate "+t+" oneOf\n         */\n        initialValidity = valid\n        initialErrorCount = errors.length\n        countOfValid = 0\n      ",n.forEach(function(n){var i=new e(n,{address:t});r+="\n        accumulatedErrorCount = errors.length\n        "+i.compile()+"\n        if (accumulatedErrorCount === errors.length) {\n          countOfValid += 1\n        }\n        "}),r+="\n          if (countOfValid === 1) {\n            valid = initialValidity\n            errors = errors.slice(0, initialErrorCount)\n          } else {\n            valid = false\n            errors.push({\n              keyword: 'oneOf',\n              message: 'what is a reasonable error message for this case?'\n            })\n          }\n      "),r}},{key:"not",value:function n(){var n=this.schema.not,t=this.address,r="";if("object"===("undefined"==typeof n?"undefined":i(n))&&null!==n&&!Array.isArray(n)){var a=n,o=new e(a,{address:t});r+="\n        /**\n         * NOT\n         */\n        if (value !== undefined) {\n          initialValidity = valid\n          initialErrorCount = errors.length\n          notValid = true\n\n          accumulatedErrorCount = errors.length\n\n          "+o.compile()+"\n\n          if (accumulatedErrorCount === errors.length) {\n            notValid = false\n          }\n\n          if (notValid === true) {\n            valid = initialValidity\n            errors = errors.slice(0, initialErrorCount)\n          } else {\n            valid = false\n            errors = errors.slice(0, initialErrorCount)\n            errors.push({\n              keyword: 'not',\n              message: 'hmm...'\n            })\n          }\n        }\n      "}return r}},{key:"properties",value:function n(){var t=this.schema,r=this.address,n=t.properties,a=t.required,o=this.push();return a=Array.isArray(a)?a:[],"object"===("undefined"==typeof n?"undefined":i(n))&&Object.keys(n).forEach(function(t){var i=n[t],s=a.indexOf(t)!==-1,u=[r,t].filter(function(e){return!!e}).join("."),l=new e(i,{address:u,require:s});o+="\n        value = container['"+t+"']\n        ",o+=l.compile()}),o+=this.pop()}},{key:"otherProperties",value:function(){return"\n      /**\n       * Validate Other Properties\n       */\n      "+this.push()+"\n\n      for (let key in container) {\n        value = container[key]\n        matched = false\n\n        "+this.patternValidations()+"\n        "+this.additionalValidations()+"\n      }\n\n      "+this.pop()+"\n    "}},{key:"patternValidations",value:function(){var n=this.schema.patternProperties,t="";return"object"===("undefined"==typeof n?"undefined":i(n))&&Object.keys(n).forEach(function(r){var i=n[r],a=new e(i);t+="\n          if (key.match('"+r+"')) {\n            matched = true\n            "+a.compile()+"\n          }\n        "}),t}},{key:"additionalValidations",value:function(){var n=this.schema,t=n.properties,r=n.additionalProperties,a=this.address,o="",s=["matched !== true"];if(Object.keys(t||{}).forEach(function(e){s.push("key !== '"+e+"'")}),"object"===("undefined"==typeof r?"undefined":i(r))){var u=r,l=new e(u,{address:a+"[APKey]"});o+="\n        // validate additional properties\n        if ("+s.join(" && ")+") {\n          "+l.compile()+"\n        }\n      "}return r===!1&&(o+="\n        // validate non-presence of additional properties\n        if ("+s.join(" && ")+") {\n          valid = false\n          errors.push({\n            keyword: 'additionalProperties',\n            message: key + ' is not a defined property'\n          })\n        }\n      "),o}},{key:"patternProperties",value:function(){var e="";return this.otherPropertiesCalled||(this.otherPropertiesCalled=!0,e+=this.otherProperties()),e}},{key:"additionalProperties",value:function(){var e="";return this.otherPropertiesCalled||(this.otherPropertiesCalled=!0,e+=this.otherProperties()),e}},{key:"minProperties",value:function e(){var e=this.schema.minProperties,n=this.address;return"\n        // "+n+" min properties\n        if (Object.keys(value).length < "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'minProperties',\n            message: 'too few properties'\n          })\n        }\n    "}},{key:"maxProperties",value:function e(){var e=this.schema.maxProperties,n=this.address;return"\n        // "+n+" max properties\n        if (Object.keys(value).length > "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'maxProperties',\n            message: 'too many properties'\n          })\n        }\n    "}},{key:"dependencies",value:function n(){var n=this.schema.dependencies,t=this.address,r=this.push();return"object"===("undefined"==typeof n?"undefined":i(n))&&Object.keys(n).forEach(function(a){var o=n[a],s=[];if(Array.isArray(o))o.forEach(function(e){s.push("container['"+e+"'] === undefined")}),r+="\n            if (container['"+a+"'] !== undefined && ("+s.join(" || ")+")) {\n              valid = false\n              errors.push({\n                keyword: 'dependencies',\n                message: 'unmet dependencies'\n              })\n            }\n          ";else if("object"===("undefined"==typeof o?"undefined":i(o))){var u=o,l=new e(u,{address:t});r+="\n            if (container['"+a+"'] !== undefined) {\n              "+l.compile()+"\n            }\n          "}}),r+=this.pop()}},{key:"required",value:function(){var e=(this.schema.properties,this.address),n="";return n+="\n      // validate "+e+" presence\n      if (value === undefined) {\n        valid = false\n        errors.push({\n          keyword: 'required',\n          message: 'is required'\n        })\n      }\n    "}},{key:"additionalItems",value:function n(){var t=this.schema,r=t.items,n=t.additionalItems,a=(this.address,"");if(n===!1&&Array.isArray(r)&&(a+="\n        // don't allow additional items\n        if (value.length > "+r.length+") {\n          valid = false\n          errors.push({\n            keyword: 'additionalItems',\n            message: 'additional items not allowed'\n          })\n        }\n      "),"object"===("undefined"==typeof n?"undefined":i(n))&&null!==n&&Array.isArray(r)){var o=n,s=new e(o),u=e.counter;a+="\n        // additional items\n        "+this.push()+"\n\n        for (var i"+u+" = "+r.length+"; i"+u+" <= container.length; i"+u+"++) {\n          value = container[i"+u+"]\n          "+s.compile()+"\n        }\n\n        "+this.pop()+"\n      "}return a}},{key:"items",value:function n(){var n=this.schema.items,t=this.address,r="";if(Array.isArray(n))r+=this.push(),n.forEach(function(n,i){var a=n,o=new e(a,{address:t+"["+i+"]"});r+="\n          // item #"+i+"\n          value = container["+i+"]\n          "+o.compile()+"\n        "}),r+=this.pop();else if("object"===("undefined"==typeof n?"undefined":i(n))&&null!==n){var a=n,o=new e(a),s=e.counter;r+="\n        // items\n        "+this.push()+"\n\n        for (var i"+s+" = 0; i"+s+" < container.length; i"+s+"++) {\n          // read array element\n          value = container[i"+s+"]\n          "+o.compile()+"\n        }\n\n        "+this.pop()+"\n      "}return r}},{key:"minItems",value:function e(){var e=this.schema.minItems,n=this.address;return"\n        // "+n+" min items\n        if (value.length < "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'minItems',\n            message: 'too few properties'\n          })\n        }\n    "}},{key:"maxItems",value:function e(){var e=this.schema.maxItems,n=this.address;return"\n        // "+n+" max items\n        if (value.length > "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'maxItems',\n            message: 'too many properties'\n          })\n        }\n    "}},{key:"uniqueItems",value:function e(){var e=this.schema.uniqueItems,n=this.address,t="";
return e===!0&&(t+="\n        // validate "+n+" unique items\n        let values = value.map(v => JSON.stringify(v)) // TODO: optimize\n        let set = new Set(values)\n        if (values.length !== set.size) {\n          valid = false\n          errors.push({\n            keyword: 'uniqueItems',\n            message: 'items must be unique'\n          })\n        }\n      "),t}},{key:"minLength",value:function e(){var e=this.schema.minLength,n=this.address;return"\n        // "+n+" validate minLength\n        if (Array.from(value).length < "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'minLength',\n            message: 'too short'\n          })\n        }\n    "}},{key:"maxLength",value:function e(){var e=this.schema.maxLength,n=this.address;return"\n        // "+n+" validate maxLength\n        if (Array.from(value).length > "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'maxLength',\n            message: 'too long'\n          })\n        }\n    "}},{key:"pattern",value:function e(){var e=this.schema.pattern,n=this.address;if(e)return"\n          // "+n+" validate pattern\n          if (!value.match(new RegExp('"+e+"'))) {\n            valid = false\n            errors.push({\n              keyword: 'pattern',\n              message: 'does not match the required pattern'\n            })\n          }\n      "}},{key:"format",value:function e(){var e=this.schema.format,n=this.address,t=o.resolve(e);if(t)return"\n      // "+n+" validate format\n      if (!value.match("+t+")) {\n        valid = false\n        errors.push({\n          keyword: 'format',\n          message: 'is not \""+e+"\" format'\n        })\n      }\n      "}},{key:"minimum",value:function e(){var n=this.schema,e=n.minimum,t=n.exclusiveMinimum,r=this.address,i=t===!0?"<=":"<";return"\n        // "+r+" validate minimum\n        if (value "+i+" "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'minimum',\n            message: 'too small'\n          })\n        }\n    "}},{key:"maximum",value:function e(){var n=this.schema,e=n.maximum,t=n.exclusiveMaximum,r=this.address,i=t===!0?">=":">";return"\n        // "+r+" validate maximum\n        if (value "+i+" "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'maximum',\n            message: 'too large'\n          })\n        }\n    "}},{key:"multipleOf",value:function e(){var e=this.schema.multipleOf,n="";if("number"==typeof e){var t=e.toString().length,r=t-e.toFixed(0).length-1,i=r>0?Math.pow(10,r):1,a=void 0;a=r>0?"(value * "+i+") % "+e*i+" !== 0":"value % "+e+" !== 0",n+="\n        if ("+a+") {\n          valid = false\n          errors.push({\n            keyword: 'multipleOf',\n            message: 'must be a multiple of "+e+"'\n          })\n        }\n      "}return n}}]),e}();e.exports=u}]);
//# sourceMappingURL=json-document.min.js.map